(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o){var i=e.name,a=e.link,u=e.likes,c=e._id,s=e.owner,l=e.currentUserId,f=o.handleDeleteCardClick,p=o.handleLikeClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=i,this._link=a,this._like=u,this._elementId=c,this._elementOwnerId=s._id,this._currentUserId=l,this._elementSelector=n,this._handleCardClick=r,this._handleDeleteCardClick=f,this._handleLikeClick=p}var n,r;return n=t,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._elementSelector).content.querySelector(".element").cloneNode(!0)}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this._elemenImg=this._element.querySelector(".element__image"),this._element.querySelector(".element__title").textContent=this._name,this._elemenImg.src=this._link,this._elemenImg.alt="".concat(this._name,"."),this.setLikeCount(this._like),this._setStateDelButton(),this.switchLike(this.getStateMyLike()),this._setEventListeners(),this._element}},{key:"handleDeleteCard",value:function(){this._element.closest(".element").remove()}},{key:"_setEventListeners",value:function(){var e=this;this._element.querySelector(".element__delete").addEventListener("click",(function(){e._handleDeleteCardClick(e._cardId)})),this._element.querySelector(".element__like").addEventListener("click",(function(){e._handleLikeClick(e._cardId)})),this._elemenImg.addEventListener("click",(function(){var t={name:e._name,link:e._link};e._handleCardClick(t)}))}},{key:"_setStateDelButton",value:function(){this._currentUserId!=this._elementOwnerId&&this._element.querySelector(".element__delete").classList.add("element__delete_disable")}},{key:"getStateMyLike",value:function(){var e=this;return Boolean(this._like.find((function(t){return t._id===e._currentUserId})))}},{key:"switchLike",value:function(e){e?this._element.querySelector(".element__like").classList.add("element__like_button_active"):this._element.querySelector(".element__like").classList.remove("element__like_button_active")}},{key:"setLikeCount",value:function(e){this._element.querySelector(".element__like_count").textContent=e.length}},{key:"reloadDataCard",value:function(e){this._like=e.likes}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formSelector=n,this._form=document.querySelector(this._formSelector),this._inputErrorClass=t.inputErrorClass,this._buttonInvalidClass=t.buttonInvalidClass,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inputErrorSelector=t.inputErrorSelector,this._messageList=this._form.querySelectorAll(this._inputErrorSelector),this._button=this._form.querySelector(this._submitButtonSelector),this._inputList=this._form.querySelectorAll(this._inputSelector)}var t,r;return t=e,(r=[{key:"_showError",value:function(e){this._form.querySelector("#".concat(e.id,"-error")).textContent=e.validationMessage,e.classList.add(this._inputErrorClass)}},{key:"_hideError",value:function(e){this._form.querySelector("#".concat(e.id,"-error")).textContent="",e.classList.remove(this._inputErrorClass)}},{key:"resetValidation",value:function(){var e=this;this._messageList.forEach((function(e){e.textContent=""})),this._inputList.forEach((function(t){t.classList.remove(e._inputErrorClass)}))}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideError(e):this._showError(e)}},{key:"enableSubmitButton",value:function(){this._button.classList.remove(this._buttonInvalidClass),this._button.disabled=!1}},{key:"disableSubmitButton",value:function(){this._button.classList.add(this._buttonInvalidClass),this._button.disabled=!0}},{key:"_setButtonState",value:function(e){e?this.enableSubmitButton():this.disableSubmitButton()}},{key:"_setEventListener",value:function(){var e=this;this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._setButtonState(e._form.checkValidity())}))}))}},{key:"enableValidation",value:function(){this._setEventListener(),this._form.addEventListener("submit",(function(e){e.preventDefault()})),this._setButtonState(this._form.checkValidity())}}])&&n(t.prototype,r),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n){var r=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=r,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"render",value:function(e){var t=this;e.forEach((function(e){return t._renderer(e)}))}},{key:"addItem",value:function(e){this._container.append(e)}},{key:"prependItem",value:function(e){this._container.prepend(e)}}])&&o(t.prototype,n),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popupNode=t,this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup__open"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup__open"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("click",(function(t){(!t.target.closest(".popup__container")&&!t.target.closest(".popup__container_image")||t.target.classList.contains("popup__close"))&&e.close()}))}}])&&a(t.prototype,n),e}();function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(r);if(o){var n=h(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return p(this,e)});function a(e,t){var n,r=t.submitPopup;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e))._submitPopup=r,n._inputList=n._popup.querySelectorAll(".popup__input"),n._popupForm=n._popup.querySelector(".popup__form"),n._submitButton=n._popup.querySelector(".popup__save"),n._text=n._submitButton.textContent,n}return t=a,(n=[{key:"_getInputValues",value:function(){var e={};return this._inputList.forEach((function(t){e[t.name]=t.value})),e}},{key:"setEventListeners",value:function(){var e=this;l(h(a.prototype),"setEventListeners",this).call(this),this._popup.addEventListener("submit",(function(t){t.preventDefault(),e._submitPopup(e._getInputValues())}))}},{key:"close",value:function(){this._popupForm.reset(),l(h(a.prototype),"close",this).call(this)}},{key:"renderLoading",value:function(e){this._submitButton.textContent=e?"Сохранение...":this._text}}])&&s(t.prototype,n),a}(u);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(r);if(o){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return b(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._popupImage=t._popup.querySelector(".popup__img"),t._popupText=t._popup.querySelector(".popup__caption"),t}return t=a,(n=[{key:"open",value:function(e){var t=e.name,n=e.link;this._popupImage.src=n,this._popupImage.alt=t+".",this._popupText.textContent=t,v(k(a.prototype),"open",this).call(this)}}])&&y(t.prototype,n),a}(u);function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(t){var n=t.porfolioNameNode,r=t.porfolioJobNode,o=t.profileAvatar;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._porfolioNameNode=n,this._porfolioJobNode=r,this._profileAvatar=o,this._usernameNode=document.querySelector(this._porfolioNameNode),this._aboutNode=document.querySelector(this._porfolioJobNode),this._avatarNode=document.querySelector(this._profileAvatar),this._username="",this._about="",this._avatar=""}var t,n;return t=e,(n=[{key:"updateUserInfo",value:function(){this._usernameNode.textContent=this._username,this._aboutNode.textContent=this._about,this._avatarNode.src=this._avatar}},{key:"getUserInfo",value:function(){return{name:this._username,about:this._about,avatar:this._avatar}}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about,r=e.avatar;this._username=t,this._about=n,this._avatar=r}}])&&S(t.prototype,n),e}();function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},O=function(){function e(t){var n=t.url,r=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=n,this._headers=r}var t,n;return t=e,(n=[{key:"getUserInfoServ",value:function(){return fetch("".concat(this._url,"users/me"),{headers:this._headers}).then(L)}},{key:"saveUserInfo",value:function(e){return fetch("".concat(this._url,"users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(L)}},{key:"getCardList",value:function(){return fetch("".concat(this._url,"cards"),{headers:this._headers}).then(L)}},{key:"saveNewCard",value:function(e){return fetch("".concat(this._url,"cards"),{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then(L)}},{key:"removeCard",value:function(e){return fetch("".concat(this._url,"cards/").concat(e),{method:"DELETE",headers:this._headers}).then(L)}},{key:"addLike",value:function(e){return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then(L)}},{key:"delLike",value:function(e){return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then(L)}},{key:"updateAvatar",value:function(e){return fetch("".concat(this._url,"users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(L)}}])&&E(t.prototype,n),e}();function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e,t,n){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=R(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=R(r);if(o){var n=R(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return q(this,e)});function a(e,t){var n,r=t.handle;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e))._handle=r,n}return t=a,(n=[{key:"open",value:function(e){j(R(a.prototype),"open",this).call(this),this._data=e}},{key:"setEventListeners",value:function(){var e=this;j(R(a.prototype),"setEventListeners",this).call(this),this._popup.addEventListener("submit",(function(t){t.preventDefault(),e._handle(e._data)}))}}])&&P(t.prototype,n),a}(u),N=document.querySelector(".profile__button_open_edit"),D=document.querySelector(".profile__button_open_add"),T=document.querySelector(".profile__overlay"),x=document.querySelector(".popup__input_edit_name"),U=document.querySelector(".popup__input_edit_job"),V={inputSelector:".popup__input",submitButtonSelector:".popup__save",inputErrorSelector:".popup__error",buttonInvalidClass:"popup__save_inactive",inputErrorClass:"popup__input_error"};function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){M(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=new O({url:"https://mesto.nomoreparties.co/v1/cohort-20/",headers:{authorization:"4707d041-e92a-46fe-bfe7-19e26cb8b84c","Content-Type":"application/json"}}),H=new r(V,'[name="form-adit"]');H.enableValidation();var z=new r(V,'[name="form-add"]');z.enableValidation();var G=new r(V,'[name="form-avatar"]');G.enableValidation();var K=new w({porfolioNameNode:".profile__title",porfolioJobNode:".profile__subtitle",profileAvatar:".profile__avatar"}),Q=null,W=null,X=function(e){console.error(e)};F.getUserInfoServ().then((function(e){Q=e._id,K.setUserInfo(e),K.updateUserInfo()})).catch(X),F.getCardList().then((function(e){te.render(e)})).catch(X);var Y=new g(".popup_type_image");Y.setEventListeners();var Z=function(e){Y.open(e)},$=new B(".popup_delete_card",{handle:function(e){F.removeCard(e).then((function(){W.handleDeleteCard(),$.close()})).catch(X)}});$.setEventListeners();var ee=function(e){var n=new t(J(J({},e),{},{currentUserId:Q}),".element-template",Z,{handleDeleteCardClick:function(e){W=n,$.open(e)},handleLikeClick:function(e){n.getStateMyLike()?F.delLike(e).then((function(e){n.reloadDataCard(e),n.switchLike(!1),n.setLikeCount(e.likes)})).catch(X):F.addLike(e).then((function(e){n.reloadDataCard(e),n.switchLike(!0),n.setLikeCount(e.likes)})).catch(X)}});return n.generateCard()},te=new i({renderer:function(e){te.addItem(ee(e))}},".elements__contener"),ne=new _(".popup_type_add",{submitPopup:function(e){ne.renderLoading(!0),F.saveNewCard(e).then((function(e){te.prependItem(ee(e)),ne.close()})).catch(X).finally((function(){ne.renderLoading(!1)}))}});ne.setEventListeners();var re=new _(".popup_type_edit",{submitPopup:function(e){re.renderLoading(!0),F.saveUserInfoServ(e).then((function(e){K.setUserInfo(e),K.updateUserInfo(),re.close()})).catch(X).finally((function(){re.renderLoading(!1)}))}});re.setEventListeners();var oe=new _(".popup_type_avatar",{submitPopup:function(e){oe.renderLoading(!0),F.updateAvatar({avatar:e.link}).then((function(e){K.setUserInfo(e),K.updateUserInfo(),oe.close()})).catch(X).finally((function(){oe.renderLoading(!1)}))}});oe.setEventListeners(),N.addEventListener("click",(function(){var e=K.getUserInfo();x.value=e.name,U.value=e.porfolioJob,H.resetValidation(),H.enableSubmitButton(),re.open()})),D.addEventListener("click",(function(){ne.open(),z.resetValidation(),z.disableSubmitButton()})),T.addEventListener("click",(function(){G.resetValidation(),G.disableSubmitButton(),oe.open()}))})();